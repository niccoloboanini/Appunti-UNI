```toc
style: bullet
min_depth: 1
max_depth: 2
```

# SISTEMI TEMPO-DISCRETO
## INTRODUZIONE
Fondamentale nella realtà lavorare in tempo discreto (ad esempio per progettare i filtri) perché risulta più facile. Ecco perché introduciamo i sistemi tempo-discreto.
- La trattazione è simile a quella del mondo tempo continuo (stessi concetti con definizioni ri-adattate al tempo discreto)

Un sistema tempo discreto è una *associazione* tra una sequenza $x[n]$ e una sequenza di uscita $y[n]$ che viene generata grazie a un operatore $T$, in questo modo:
$$
y[n] = T\big(x[n]\big)
$$
- così come nel mondo continuo avevamo una associazione $x(t) \rightarrow y(t)$
- nel mondo tempo discreto abbiamo una sequenza e un *sistema (descritto dall'operatore $T$)* che associa tale sequenza a un'altra sequenza di uscita
	Dalle caratteristiche di $T$ derivano tutte le informazioni utili per studiare questo argomento

## PROPRIETA' DEI SISTEMI

### SENZA MEMORIA
Se:
$$
y[n_{0}]  \quad \text{dipende soltanto da } x[n_{0}]
$$
Ovvero se $y$ all'istante $n_{0}$ dipende solo da $x[n_{0}]$, ovvero solo dall'ingresso al medesimo istante (non da quelli passati o futuri)

### SISTEMA LINEARE
Se vale il *principio di sovrapposizione degli effetti*:
$$
T(a_{1} \ x_{1}[n] + a_{2} \ x_{2}[n] ) = a_{1} \ T(x_{1}[n]) + a_{2} \ T(x_{2}[n] )
$$
- Operatore $T$ applicato alla somma degli ingressi uguale alla somma dell'operatore $T$ applicato ai singoli ingressi
 
### TEMPO INVARIANTE
Si ha:
$$
\begin{align*}
&y[n] \quad\quad\ = T(x[n]) \\
\Rightarrow \ &y[n-n_{0}] = T(x[n-n_{0}])
\end{align*}
$$
Applicando l'operatore $T$ (sistema) all'ingresso traslato di $n_{0}$ campioni, si ottiene la sequenza di uscita traslata anch'essa di $n_{0}$ campioni

### CAUSALE
Se:
$$
y[n_{0}]  \quad \text{dipende soltanto da } x[n_{0}],n[n_{0-1}],x[n_{0-1}]\dots
$$
Ovvero dipende soltanto dai campioni dell'ingresso agli istanti precedenti

### STABILE (in senso BIBO)
Se:
$$
|x(t)|<k  \quad , \quad \forall t
$$
Esiste cioè una fascia $[-k;k]$ tale che riesce a "racchiudere il segnale".
![[Pasted image 20220519102311.png|300]]

Un segnale è **bibo-stabile** se:
$$
\forall \ x[n] \ \text{ limitato} \implies y[n] \ \text{ limitato}
$$
(ingresso limitato - uscita limitata)

# SISTEMA LINEARE TEMPO INVARIANTE (LTI)
- Dimostrazione analoga al caso continuo

Vale la seguente relazione:

$$
x[n] = x[n] * \delta[n] = \sum_{k=-\infty}^{\infty} x[k] \ \delta[n-k]
$$
- Ovvero ogni sequenza è la somma di tanti impulsi discreti unitari $\delta$ traslati e poi moltiplicati per i campioni della sequenza
![[Pasted image 20220519103254.png|400]]

Proviamo adesso a inserire il risultato della convoluzione all'interno dell'operatore $T$:
$$
y[n] = T(x[n]) = T(\sum_{k=-\infty}^{\infty} x[k] \ \delta[n-k])
$$
- Applicando la *linearità*:
$$
= \sum_{k=-\infty}^{\infty} x[k] \ T(\delta[n-k])
$$
- Definiamo ora: $\displaystyle h[n] = T(\delta[n])$ (vedi dopo):
- Applichiamo quindi la *tempo invarianza* così da avere valida la relazione:
$$
h[n-k] = T(\delta[n-k])
$$
	- Si ottiene quindi:
$$
\huge\boxed{\sum_{k=-\infty}^{\infty} x[k] h[n-k] = x[n] * h[n]}
$$
	- (dove $h$ è la *risposta impulsiva del sistema*, ovvero la risposta del sistema quando l'ingresso è un impulso discreto unitario: $h[n]=T(\delta[n])$)
	*- Quindi si nota che se un sistema è LTI, l'uscita è sempre calcolabile come l'ingresso convoluto per una sequenza particolare ovvero la risposta impulsiva*
		- Quindi una volta noto l'ingresso e $h[n]$ posso calcolare tutte le uscite del sistema

![[Pasted image 20220519112453.png]]


## CLASSIFICAZIONE DEGLI LTI
A differenza del mondo tempo continuo, è importante nel mondo tempo discreto classificare i sistemi in base al tipo di risposta impulsiva (finita, infinita). 
In particolare:
#### SISTEMI FIR
$$
h[n] \longrightarrow \text{sequenza finita (Finite Impulse Response [FIR])}
$$
#### SISTEMI FIR
$$
h[n] \longrightarrow \text{sequenza infinita (Ininite Impulse Response [IIR])}
$$


## CONNESSIONE IN PARALLELO
![[Pasted image 20220519114637.png|400]]

Si ha una uscita generale $y[n]$ così definita:
$$
\begin{align*}
y[n]&=y_{1}[n]+y_{2}[n] \\
&=x[n] * h_{1}[n]+x[n] * h_{2}[n]\\
&= x[n] * (h_{1}[n]+h_{2}[n])\\
&= x[n] \ \ * \underbrace{h[n]}_{h_{1}[n]+h_{2}[n]}
\end{align*}
$$
- L'ultima riga ci garantisce che il sistema è LTI
- La riposta impulsiva totale è la *somma* delle due risposte impulsive

## CONNESSIONE IN SERIE (cascata)
![[Pasted image 20220519115140.png|400]]

Si ha una uscita generale $y[n]$ così definita:
$$
\begin{align*}
y[n]&=y_{1}[n]*h_{2}[n] \\
&=\underbrace{(x[n] * h_{1}[n])}_{y_{1}[n]}*h_{2}[n]\\
&= x[n] * (h_{1}[n]*h_{2}[n])\\
&= x[n] \ \ * \underbrace{h[n]}_{h_{1}[n]*h_{2}[n]}
\end{align*}
$$
L'ultima riga ci garantisce che il sistema è LTI
- La riposta impulsiva totale è la *convoluzione* delle due risposte impulsive
- L'ordine della serie non è importante grazie alle proprietà dell'operatore di convoluzione

## STABILITA'
Abbiamo già detto che un sistema tempo-discreto è *bibo-stabile* se $\forall x[n] \ \ \text{limitato} \rightarrow \ y[n] \ \text{limitata}$ 
- vale per tutti i sistemi (non solo per gli LTI)

Se il sistema è LTI (cioè avente caratteristiche particolari come già visto), cosa si può dire **in più** per la *stabilità*? C'è qualche condizione "meno forte" o alternativa che me la garantisce?
- Si può dimostrare [TEOREMA] che se un sistema è bibo-stabile, allora **la risposta impulsiva è assolutamente sommabile**, ovvero
$$
\text{Sistema bibo-stabile} \Rightarrow \ \sum_{n=-\infty}^{\infty} |h[n]| < \infty
$$
Si dimostra che si può dire anche il contrario, ovvero:
$$
\text{Sistema bibo-stabile} \Leftarrow \ \sum_{n=-\infty}^{\infty} |h[n]| < \infty
$$
Allora si può riassumere in questo modo:
$$
\boxed{\huge \text{Sistema bibo-stabile} \iff \ \sum_{n=-\infty}^{\infty} |h[n]| < \infty }
$$

**Dimostrazione:**
[analoga al tempo continuo]
- si basa in senso "$\Rightarrow$" sul fatto che l'uscita è la convoluzione dell'ingresso alla risposta impulsiva
- si basa in senso "$\Leftarrow$" per assurdo


Vediamo come questo teorema influisce sulla stabilità dei vari sistemi.

### STABILITA' DEI FIR
>> I sistemi $FIR$ sono sempre *stabili*

Infatti, se $h[n]$ è una sequenza finita di $N$ campioni (lunghezza risposta impulsiva):
$$
h[n] = \{ h[0],h[1],\dots,h[N-1] \}
$$
Allora vale (la sommatoria si riduce):
$$
\sum_{n=0}^{N-1} |h[n]| < \infty \quad \text{(perché i campioni sono finiti)}
$$
### STABILITA' DEI IIR
>> Non sempre è garantita la stabilità dei sistemi $IIR$

Infatti se $h[n]$ è composta da un numero infinito di campioni (nota: $h[n]$ può essere: *monolatera sinistra, destra o bilatera*) allora abbiamo la stabilità solo se l'assoluta sommabilità è verificata, ovvero:
$$
h[n] \ \text{stabile solo se vale } \ \sum_{n=-\infty}^{\infty} (h[n])<\infty  
$$
- Dobbiamo cioè per i sistemi $IIR$ vedere la risposta impulsiva caso per caso (non si può dire niente a priori sulla stabilità)

### STABILITA' DEI SISTEMI CAUSALI
Sistema causale:
$$
y[n_{0}] \ \text{dipende solo dai campioni passati}
$$
Si può valutare la causalità di un sistema osservando la risposta impulsiva?
$$
\begin{align*}
y[n_{0}] &= \sum_{k=-\infty}^{\infty} h[k] \ x[n_{0}-k] \\
&= \underbrace{\dots h[-2]x[n_{0}+2]  + h[-1]x[n_{0}+1]}_{\text{non devono comparire}}+ \ h[0]x[n_{0}]+h[1]x[n_{0}-1]+h[1]x[n_{0}-2]\dots
\end{align*}
$$
Pertanto vale se:
$$
h[k] = 0  \quad , \quad k<0
$$
*In questo modo l'uscita dipende solo dai campioni del presente e del passato (non futuri)*

Pertanto anche la causalità si deduce bene dalla osservazione soltanto della risposta impulsiva

## SISTEMI ELEMENTARI
### RITARDATORE
Sia:
$$
h[n] = \delta[n-n_{0}]
$$
Allora l'uscita sarà data da:
$$
\begin{align*}
y[n] &= x[n] *h[n]\\
&= \sum_{k=--\infty}^{\infty} h[k]x[n-k]\\
&= \sum_{k=-\infty}^{\infty} \underbrace{\delta [k-n_{0}]}_{\begin{cases}
k=n_{0} \rightarrow 1 \\k \neq n_{0} \rightarrow 0
\end{cases}} x[n-k]\\
&=x[n-n_{0}]
&\end{align*}
$$
Pertanto un impulso ritardato di $n_{0}$ inserito nel sistema ritardatore causa un ritardo dell'ingresso

### A MEDIA MOBILE

$$
h[n]=\begin{cases}
\frac{1}{N} & 0 \leq n \leq N-1 \\
0 & \text{altrove}
\end{cases}
$$
![[Pasted image 20220519124522.png]]
- È evidentemente una sequenza $FIR$ 
- Ricorda un rettangolo nel tempo

Ci chiediamo quale sia l'effetto di questo sistema sul segnale d'ingresso.
$$
\begin{align*}
y[n] &= x[n]*h[n]\\
&= \sum_{k=-\infty}^{\infty} h[k]\ x[n-k]\\
&= \sum_{k=0}^{N-1} \frac{1}{N}\ x[n-k]\\
&= \frac{1}{N} \sum_{k=0}^{N-1} \ x[n-k]
\end{align*}
$$
Ovvero il sistema a ogni istante $n$ fornisce in output la somma degli ultimi $n$ campioni diviso $N$, ovvero ne fa *la media*.
Graficamente (finestra mobile):
![[Pasted image 20220519125452.png|500]]

###  INTEGRATORE
Sia:
$$
h[n] = u[n]
$$
In uscita:
$$
\begin{align*}
y[n] &= x[n] * u[n]\\
&= \sum_{k=-\infty}^{\infty} u[k] \cdot x[n-k]\\
&= \sum_{k=0}^{\infty} \underbrace{u[k]}_{1} \cdot x[n-k]
\end{align*}
$$
Quindi:
$$
y[n] = \sum_{k=0}^{\infty} x[n-k]
$$
>> Esegue cioè la **somma dei campioni precedenti**, ovvero una specie d'integrazione dei campioni arrivati*

Graficamente (all'istante $n$ esegue la somma di tutti i campioni precedenti. Si riesegue poi per ogni istante):
![[Pasted image 20220519130009.png|400]]

In generale, *questo sistema non è stabile!* (perché la finestra di somma è composta potenzialmente da infiniti termini)

- Ad esempio se abbiamo un gradino, non vale la *bibo-stabilità*: la sequenza gradino è infatti limitata, ma l'uscita è illimitata (abbiamo una rampa):
![[Pasted image 20220519130253.png|400]]
- ciò si notava anche dalla risposta impulsiva, infatti $\sum_{n=-\infty}^{\infty} |h[n]|$, con $h[n]=u[n]$ non è assolutamente sommabile, ovvero $\sum_{n=-\infty}^{\infty} |u[n]|=\infty$


**NOTA:** l'uscita di una sequenza instabile non per forza è illimitata. Esempio:
$$
x[n] = \cos 2\pi F_{0}n \ u[n]
$$
- è instabile ma la risposta non è illimitata

### DERIVATORE
L'inverso dell'integratore:
$$
h[n]= \{ 1;-1\} = \begin{cases}
1 & n=0 \\
-1 & n=1 \\
0 & \text{altrove}
\end{cases}
$$
![[Pasted image 20220519130738.png]]

Si ottiene facendo i conti:
$$
y[n] = x[n] - x[n-1]
$$
- che assomiglia a una derivazione (per quanto possibile nel mondo discreto)

## COME POSSIAMO DESCRIVERLO
Per descrivere un sistema LTI nel mondo continuo abbiamo
- Preso un generico $h(t)$ che rappresenta la risposta impulsiva, ovvero la risposta del sistema alla delta di Dirac
- Eseguito la sua trasformata di Fourier, ovvero ottenuto la risposta in frequenza $H(f)$: essa fornisce le informazioni per calcolare l'uscita quando l'ingresso è un tono (puro)
- Se abbiamo una equazione differenziale viene prodotto un sistema LTI
	- Per descrivere l'equazione differenziale potremmo usare in modo alternativo la trasformata di Laplace $H(S)$ (ma non l'abbiamo trattata)

Abbiamo poi fatto già il parallelo nel mondo tempo discreto, infatti abbiamo:
- Preso una sequenza $h[n]$ che rappresenta l'equivalente della risposta impulsiva, ovvero la risposta del sistema alla sequenza impulso discreto unitario. Grazie a tale sequenza sappiamo definire una convoluzione nel mondo tempo discreto che ci permette di calcolare l'uscita in modo semplice
- La sua trasformata ha un utilizzo simile alla risposta in frequenza nel caso tempo continuo (ma ancora dobbiamo descrivere tale passaggio). Si indica comunque con $H(F)$
- Se abbiamo una *equazione alle differenze finite* viene prodotto un sistema LTI tempo discreto.
	- Per descriverle, faremo uso della *trasformata Z* della risposta impulsiva, ovvero $H(Z)$, che viene detta funzione di trasferimento

Riassumendo:
![[Pasted image 20220519154041.png]]

## EQUAZIONE ALLE DIFFERENZE FINITE
Un sistema in cui vale la seguente relazione:
$$
\sum_{k=0}^{N} a_{k} \ y[n-k] = \sum_{k=0}^{M} b_{k}\ x[n-k]
$$
**è un sistema LTI**.
Tale equazione è detta *equazione alle differenze finite*.
- E' il modo più semplice per implementare un sistema LTI (nella pratica)

Infatti (**Dimostrazione:**):

Supponendo $a_{0}\neq 0$, si ottiene:
$$
a_{0}\ y[n] + \sum_{k=1}^{N} a_{k}\ y[n-k] = \sum_{k=0}^{M} b_{k}\ x[n-k]
$$
Dividendo per $a_{0}$ e portando a destra la sommatoria:
$$
y[n] = \underbrace{-\sum_{k=1}^{N} \frac{a_{k}}{a_{0}}\ y[n-k]}_{\text{uscite precedenti}} + \underbrace{\sum_{k=0}^{M} \frac{b_{k}}{a_{0}}\ x[n-k]}_{\text{ingressi precedenti}}
$$
In maniera alternativa ma più sintetica, si può giungere al seguente risultato:
$$
\Large \boxed{y[n] = \underbrace{-\sum_{k=1}^{N} a_{k}\ y[n-k]}_{\text{uscite precedenti}} + \underbrace{\sum_{k=0}^{M} b_{k}\ x[n-k]}_{\text{ingressi precedenti}}}
$$
(che è la formula usata per *implementare un sistema*)
Ovvero: *l'uscita $y[n]$ è calcolabile utilizzando gli ingressi e le uscite precedenti*
	**- ed è inoltre calcolabile in modo sistematico (algoritmico)**
![[Pasted image 20220519160425.png|500]]
- Dove in generale $M,N,a_k,b_k$ sono da scegliere in fase di progetto
## FUNZIONE DI TRASFERIMENTO
Permette di passare dalla risposta impulsiva alla equazione alle differenze finite o viceversa.

Se consideriamo $y[n]$ generico (ovvero: $y[n] = x[n] * h[n]$) a cui applichiamo la trasformata Z ambo i membri si ottiene:
$$
Y[z] = x[z] \cdot h[z] 
$$
Quindi:
$$
H(Z) = \mathcal{Z}\{ h[n] \}
$$
, ovvero la trasformata Z della risposta impulsiva.

Analogamente:
$$
H(Z) = \frac{Y(z)}{X(z)}
$$
, ovvero il rapporto tra le trasformate Z di uscita e ingresso.


## LEGAME EQ. ALLE DIFF. FINITE CON H(Z)
### TRASFORMATA -->
Dall'equazione alle differenze finite:
$$\sum_{k=1}^{N} a_{k}\ y[n-k] = \sum_{k=0}^{M} b_{k}\ x[n-k]$$
Applichiamo la trasformata Z ambo i membri:
$$
\sum_{k=0}^{N} a_{k} \ Y(z)\cdot z^{-k} = \sum_{k=0}^{M} b_k X(z) \cdot z^{-k}
$$
Da cui:
$$
	Y(z) \sum_{k=0}^{N} a_{k}\ z^{-k} = X(z)\sum_{k=0}^{M} b_{k} \ z^{-k}
$$
Quindi:
$$
H(Z)=\frac{Y(Z)}{X(Z)}=\frac{\sum_{k=0}^{M} b_{k} \ z^{-k}}{\sum_{k=0}^{N} a_{k}\ z^{-k}}
$$

Quindi partendo dalla equazione alle differenze finite (dipendente e legata da alcuni coefficienti da scegliere in fase di progetto $N,M,a_k,b_k$), abbiamo ricavato la funzione di trasferimento come il rapporto di due polinomi, che appunto è (supponendo ancora $a_0=1$):
$$
\boxed{\huge H(Z)=\frac{\sum_{k=0}^{M} b_{k} \ z^{-k}}{\sum_{k=0}^{N} a_{k}\ z^{-k}}}
$$- è cioè una *funzione razionale*, che sappiamo trattare in particolar modo bene nel dominio Z

### ANTITRASFORMATA <--
Partendo dalla $H(Z)$ si può eseguire il passaggio inverso eseguendo l'antitrasformata, ovvero vale:
$$
H(Z) \overbrace{\longrightarrow}^{\huge z^{-1}} h[n]
$$
- che si può effettuare dato che $H(Z)$ è razionale nei casi che abbiamo visto

### LEGAME FIR - IIR nelle EQ. ALLE DIFFERENZE

#### Caso $FIR$ 
- con $N$ campioni (finiti): 
$$
h[n] \quad \{ h[0],h[1],\dots,h[N-1] \}
$$
Eseguendo la convoluzione con un segnale d'ingresso come già visto si ottiene:
$$
y[n] = \sum_{k=0}^{N-1}h[k] \ x[n-k] 
$$
, ovvero produce una *equazione alle differenze finite*. Con la particolarità che:
- **Utilizza solo gli ingressi precedenti per calcolare l'uscita $y[n]$** (non vengono utilizzate le uscite precedenti)
	- (A volte detto per questo non ricorsiva)

La relativa funzione di trasferimento:
$$
\begin{align*}
H(Z) &= \sum_{n=-\infty}^{\infty} h[n] \ z^{-n}\\
&= \sum_{n=0}^{N-1} h[n] \ z^{-n} 
\end{align*}
$$
**È un polinomio**


#### Caso $IIR$
Si ha:
$$
y[n] = -\sum_{k=1}^{N}a_k \ y[n-k] +\sum_{k=0}^{M}b_K \ x[n-k] 
$$
Ha come abbiamo già visto (supponendo $a_{0}=1$):
$$
H(Z) = \frac{\sum_{k=0}^{M} b_{k} z^{-k}}{1+\sum_{k=1}^{N} a_{k}\ z^{-k}}
$$
Quindi in pratica $H(Z)$ (funzione razionale e dipendente anche dalle uscite precedenti) ha necessariamernte una risposta impulsiva $h[n]$ di tipo $IRR$ (o viceversa), perché
- è legato alla trasformata inversa delle funzioni razionali
	- Infatti *se ci sono dei poli*, allora vengono prodotte queste possibili sequenze:
![[Pasted image 20220519165815.png|500]]
Aventi **tutte** un numero infinito di campioni (e quindi la risposta impulsiva sarà IIR).

In maniera duale (leggendo al contrario tale relazione):
>> Un sistema IIR ha necessariamente una funzione di trasferimento razionale (con il denominatore avente dei poli che producono sequenze esponenziali di durata infinita) e una equazione alle differenze finite in cui per calcolare l'uscita servono le uscite precedenti.


###  ESERCIZIO: PASSAGGIO H(Z)-->h(n)
Si vuole eseguire il passaggio:
$$
H(Z) \longrightarrow h[n]
$$
- è un passaggio molto comune perché spesso in fase di progettazione si analizza nel mondo della frequenza

Ci si chiede quindi come conoscere la risposta impulsiva. Ciò si esegue in generale con l'operazione di antitrasformata:
$$
H(Z) \overbrace{\longrightarrow}^{\Large \mathcal{Z^{-1}}} h[n]
$$
- *tuttavia, se non si conosce la regione di convergenza, l'antitrasformata è ambigua* (posso avere più $h[n]$ a partire da una sola $H(Z)$)

#### ESEMPIO/ESERCIZIO
Sia:
![[Pasted image 20220520110043.png|300]]
Eseguendo la scomposizione in fratti semplici si ottiene:
![[Pasted image 20220520113224.png|400]]

Andiamo a **trovare i poli**: essi corrispondono ai punti di "delimitazione" delle $ROC$
	- Si osserva che i poli sono: $\displaystyle \frac{1}{3}  \quad , \quad 2$
Con le relative $3 \ ROC$:
![[Pasted image 20220520110337.png|500]]

Ci chiediamo: *quale $ROC$ scelgo affinché il sistema sia **stabile***

Abbiamo già dimostrato che:
$$
BIBO-STABILITA'  \quad \iff \quad \sum_{n=-\infty}^{\infty}|h[n]| < \infty  \quad \implies \quad H(f) \ \text{convergente}
$$
- La bibo-stabilità implica convergenza di $H(f)$ perché una condizione sufficiente per la convergenza della trasformata di Fourier per sequenze è proprio che la sequenza sia assolutamente sommabile
- dove $H(f)$ è proprio la trasformata di Fourier per sequenze di $h[n]$

Dato che la trasformata di Fourier è la trasformata Z calcolata sul cerchio unitario (ovvero: $\left.H(f)=H(z)\right|_{z=e^{j2\pi F}})$, si giunge alla seguente (più completa) relazione:
$$
\boxed{\small BIBO-STABILITA'  \quad \iff \quad \sum_{n=-\infty}^{\infty}|h[n]| < \infty  \quad \implies \quad H(f) \ \text{convergente}  \quad \implies \quad \stackrel{H(Z) \text{ convrgente}}{\small\text{per } z= \text{ cerchio unitario}}}
$$
*In definitiva, il cerchio unitario deve appartenere alla $ROC$ di $H(Z)$*
Confronta qua:
![[Pasted image 20220520112730.png|390]]


**Quindi abbiamo stabilità quando la regione di convergenza include il cerchio unitario**

Tornando al nostro esercizio:
![[Pasted image 20220520113018.png|300]]

Tra tutte le $ROC$ possibili, si sceglie la regione anulare per avere stabilità:
$$
ROC =\{z:\frac{1}{3}<|z|<2\}
$$
- è l'unica che produce un sistema stabile

Pertanto, *calcoliamo la risposta impulsiva per avere un sistema stabile*:
	- per il primo addendo si sceglie la monolatera destra
	- per il secondo addendo si sceglie la monolatera sinistra)
- $\Rightarrow$ in totale viene una bilatera (ce lo potevamo aspettare ricordando che la $ROC$ è una regione anulare)

![[Pasted image 20220520113728.png|400]]

### ESERCIZIO: PASSAGGIO H(Z) --> EQ. ALLE DIFFERENZE FINITE
Sceglieremo sempre $H(Z)$ formata da *un solo polo*.

Esempio (polo in $z=a$):
$$
H(Z) = \frac{1}{1-a\ z^{-1}} = \frac{z}{z-a}$$
Calcoliamo l'equazione alle differenze finite, ricordando che:
$$
H(Z) = \frac{Y(Z)}{X(Z)} = \frac{1}{1-a\ z^{-1}}
$$
Manipolando la frazione si può ottenere facilmente:
$$
Y(Z) \cdot (1-a \ z^{-1}) = X(Z)
$$
Moltiplicando:
$$
Y(Z) - a \ Y(Z) \ z^{-1} = X(Z) 
$$
Da cui si applica la *trasformata Z inversa* (ricordando ad esempio che $z^{-1}$ produce un ritardo)
$$
y[n] - a \ y[n-1] = x[n] 
$$
Isolando $y[n]$ si ottiene l'equazione alle differenze finite:
$$
\boxed{y[n] = a \ y[n-1] + x[n] }
$$
Che è la soluzione richiesta.

#### STABILITà
L'equazione appena ottenuta *non garantisce sempre la stabilità*, infatti:

Ricavando $h[n]$:
$$
h[n] = T(\delta[n])
$$
- ovvero come operatore $T$ applicato all'ingresso dato dall'impulso discreto unitario (ovvero la definizione di risposta impulsiva: come reagisce il sistema a un impulso unitario $\delta[n]$)
- Quindi come ingresso abbiamo $x[n] = \delta[n]$, ovvero
![[Pasted image 20220520115514.png|250]]

**Ci chiediamo quanto vale l'uscita, ovvero $y[n]$**

(nota: si riesce a calcolare l'uscita se si conosce l'ingresso a tale istante $n$ e l'uscita precedente... dato che non conosciamo in generale l'uscita precedente, si suppone la seguente:)
>> Ipotizziamo di avere un sistema in **quiete**: $y[n] = 0  \quad se \quad x[n]=0$

Ovvero nel nostro caso equivale ad avere:
$$
y[n] = 0  \quad , \quad n\leq 1
$$
Quindi per ora:
![[Pasted image 20220520120800.png|300]]

Procediamo quindi a calcolare $y[0]$, utilizzando l'equazione alle differenze finite ricavata:
$$
y[0] = a \ y[-1]+x[0] = 0+1 = 1
$$
Andando avanti:
$$
y[1] = a \ y[0] + x[1] = a \cdot 1 + 0 = a
$$
Ancora:
$$
y[2] = a \ y[1]+x[2] = a \cdot a + 0 = a^{2}
$$
Il pattern quindi è il seguente:
$$
y[n] = a^{n}  \quad , \quad a \geq 0
$$

Per cui mettendo insieme anche i valori negativi:
$$
\boxed{y[n] = a^{n} \ u[n]}
$$

Il risultato ottenuto è coerente infatti valgono le seguenti relazioni:
![[Pasted image 20220520121733.png|500]]
- dove le frecce indicano i legami di trasformata/antitrasformata
- dove $h[n]$ corrisponde all'uscita $y$ che ci siamo appena calcolati
- vale in particolare $H(Z)$ scegliendo una $ROC = \{z:|z|>a\}$, caratteristica di una sequenza monolatera destra (infatti $h$ è monolatera destra ($\triangle$))

> [!important] NOTA BENE ($\triangle$)
>se l'equazione alle differenze è una *equazione ricorsiva "in avanti"* come nel caso appena visto (in avanti: calcolo dell'uscita in base a quelle precedenti andando quindi in avanti come progressione degli indici) *implica risposta impulsiva monolatera destra* e inoltre *implica regione di convergenza di $H(Z)$ esterno del cerchio* 


#### STABILITà
1) controllo che $h[n] = a^{n}u[n]$ è assolutamente sommabile
	>> Questo vale solo per alcuni valori di $a$, in particolare: $|a|<1$
2) ricordando che $\displaystyle H(Z)=\frac{z}{z-a}$ ha un polo in $a$ ha quindi $ROC = \{z:|z|>|a|\}$, ovvero esterni alla circonferenza su $a$. Dato che la $ROC$ deve includere la circonferenza unitaria, si deve scegliere $a<1$. Ecco graficamente:
![[Pasted image 20220520123010.png|500]]

#### Stabilità con $|a|>1$
Per i calcoli che abbiamo visto fin ora, il sistema non è stabile per valori di $a$ maggiori a $1$ in modulo. Vediamo però se con opportune manipolazioni si può migliorare la situazione:
$$
y[n] = a \ y[n-1] + x[n]
$$
Andiamo a cambiare $n$ in $n+1$:
$$
y[n+1] = a \ y[n] + x[n+1]
$$
Isolando $y[n]$
$$
\underbrace{\boxed{y[n] = \frac{y[n+1]-x[n+1]}{a}=\frac{1}{a}\cdot y[n+1]-x[n+1]}}_{\Large \text{ricorsiva all'indietro}}
$$
Che è una nuova sequenza ricorsiva associata alla stessa $H(Z)$. Tuttavia questa nuova ricorsione *va all'indietro*, non in avanti. Questo perché l'uscita è calcolata a partire dagli ingressi **futuri** ($x[n+1]$).
- Questo calcolo è infattibile nel mondo tempo continuo
- Diventa invece possibile nel tempo discreto a patto di *memorizzare tutti i campioni di una sequenza*
	- La ricorsione partirà quindi da $+\infty$ e andrà all'indietro

*Nota bene:*
- In maniera del tutto analoga, si poteva giungere alla stessa relazione anche partendo da $X(Z)$, in questo modo:
- ![[Pasted image 20220520154632.png]]
- Dove nell'ultimo passaggio è stata calcolata l'antitrasformata di una sequenza
	- In particolare, $\mathcal{Z}\{z \ X(Z)\}^{-1} = x[n+1]$ è una applicazione del teorema del ritardo (solo che adesso abbiamo un anticipo perchè invece di $z^{-n}$ o $z^{-1}$ abbiamo $z^{+1}$).

 
 La cosa importante (da dimostrare), è che alla sequenza ricorsiva all'indietro appena trovata, ovvero $y[n] =\frac{1}{a}\cdot y[n+1]-x[n+1]$ è **associata una risposta impulsiva monolatera sinistra**.
*- Nota: non esiste sequenza ricorsiva bilatera*

Per calcolarla bisogna partire dal "futuro" e andare indietro in questa direzione:
![[Pasted image 20220520155304.png]]
Dato che il sistema è in *quiete*:
$$
y[n] = 0  \quad , \quad n =1,2,\dots,\infty
$$
In particolare:
$$
y[0] = \frac{1}{a}(y[1]-x[1]) = 0
$$
$$
y[-1] = \frac{1}{a}(y[0]-x[0]) = \frac{1}{a} \ (0-1) = -\frac{1}{a}=-a^{-1} 
$$
$$
y[-2] = \frac{1}{a}(y[-1]-x[-1]) = \frac{1}{a}(-a^{-1}-0) = -a^{-2} 
$$
$$
y[-3] = \frac{1}{a}(y[-2]-x[-2]) = \frac{1}{a}(-a^{-2}-0) = -a^{-3} 
$$
Pertanto una volta capito il pattern si può trovare facilmente il *termine generico*:
$$
\boxed{y[n] = -a^{n}}
$$
 (controlla i conti qui):
  ![[Pasted image 20220520155824.png|300]]

Il risultato finale è quindi (ricordando che l'uscita $y[n]$ è uguale a $h[n]$ perché come ingresso abbiamo un impulso discreto unitario):
$$
y[n] = h[n] = -a^{n}\ u[-n-1]
$$
- Che è proprio la trasformata inversa di $H(Z) = \frac{z}{z-a}$ quando la $ROC=\{z:|z|<|a|\}$ 
	- Ovvero alla equazione ricorsiva all'indietro produce una risposta impulsiva monolatera sinistra che nel mondo della trasformata Z corrisponde a una $ROC$ interna al cerchio di raggio $a$

Parlando di stabilità infatti, la $ROC$ include il cerchio di raggio unitario, essendo $|a|>1$ e dovendo prendere tutti i valori $z$ più piccoli di tale $a$.  Graficamente:
![[Pasted image 20220520160404.png|300]]

- **il sistema LTI è stabile quando$|a|>1$**

---
Pertanto lo stesso sistema $H(Z) = \frac{1}{z-a}$ può essere implementato in due modi diversi
![[Pasted image 20220520160734.png]]
Pertanto si può dire che:
- se $a$ è esterno al cerchio unitario e si implementa il sistema con una equazione ricorsiva in avanti, il sistema è *instabile*
- se $a$ è interno al cerchio unitario e si implementa il sistema con una equazione ricorsiva all'indietro, il sistema è *instabile*


### ESERCIZIO COMBINATO
Sia (già vista in uno scorso esercizio):
![[Pasted image 20220520161430.png|300]]
- che come già visto è una *sequenza bilatera*

Scomponendo in fratti semplici si ottiene:
![[Pasted image 20220520161637.png|400]]

Ci chiediamo: *come si implementa in modo stabile il seguente sistema?*

Notiamo che:
- è un sistema in *parallelo*: inoltre ogni addendo ha poli semplici (del 1° ordine)

![[Pasted image 20220520161930.png|300]]

- Non si può implementare il sistema in modo stabile utilizzando una sola ricorsione (o in avanti o all'indietro)
	- Questo perché i poli stanno:
		- Uno dentro il cerchio unitario
		- Uno fuori dal cerchio unitario
- Si deve perciò effettuare una *ricorsione in avanti per $H_{1}$ e una ricorsione all'indietro per $H_2$* per avere speranze d'implementarlo in modo stabile
- Dato che una equazione alle differenze finite *non può essere bilatera*, **non basta una sola equazione alle differenze finite**
	- Dovremo perciò usare *due distinte equazioni ricorsive (una avanti e una indietro)* a seconda del termine (addendo) di riferimento ($H_1$ o $H_2$)

Dato che le equazioni le avevamo già calcolate prima, possiamo subito concludere e quindi esplicitare le uscite $y_{1}[n]$ e $\ y_{2}[n]$ finali (ricordando che $a$ è il polo):
![[Pasted image 20220520162931.png|500]]

Calcolando separatamente $y_1$ e $y_2$ si ottiene:
$$
y[n] = y_{1}[n] + y_{2}[n]
$$
> [!bug] **Lasciando le due separata perché altrimenti il sistema diventa instabile**.
> 

> [!bug] Se non ci fossimo accorti del polo esterno al cerchio unitario
> Implementiamo quindi con la ricorsione in avanti:
>![[Pasted image 20220520163611.png]] 
>**Avremmo ottenuto un sistema instabile perché la $ROC$ non include il cerchio unitario:**
>![[Pasted image 20220520163751.png|300]]


### CRITICITA' DELLA RICORSIONE ALL'INDIETRO
La prima difficoltà sta nel fatto che prima si deve *memorizzare l'intero segnale* e poi andare a processare il segnale
- viene per questo detto **processamento NON in real-time**

#### PROCESSO REAL-TIME
Un processo è in real-time se:
	- si segue l'acquisizione "naturale" del segnale (indice temporale crescente)
		- all'arrivo di un campione posso calcolare l'uscita all'istante relativo
	- Quindi acquisizione del segnale e produzione dell'uscita simultaneamente

Questo non è possibile con la ricorsione all'indietro, perché prima si devono acquisire tutti i campioni
- Nelle applicazioni reali diventa scomodo perché appunto il filtraggio non si effettua in diretta durante l'esecuzione del segnale
	- (esempio: telefonata - bisognerebbe aspettare che finisca, memorizzare il segnale emesso e quindi elaborarlo... Diventa poco pratico [nel caso invece real time si esegue una acquisizione temporanea, si elabora quella e poi si procede in avanti appunto con la parte rimanente])
	- (esempio meno problematico: acquisizione di una immagine - in questo caso non ci sono grosse differenze tra fare la ricorsione in avanti o indietro naturalmente (non c'è bisogno di una acquisizione progressiva))

### ESERCIZIO ALTERNATIVO 
Supponendo che il sistema è *stabile*, sia:
![[Pasted image 20220520165810.png|300]]

Troviamo: 1) $h[n]$ e 2) equazione alle differenze finite

#### 1) Calcolo di $h[n]$
A partire dalla $H(Z)$ calcoliamo la sua trasformata inversa (ricordando che il sistema è stabile)

- fratti semplici [...]
![[Pasted image 20220520170023.png]]
- troviamo i poli ($\frac{1}{2}$ e $2$) e rappresentiamo le $ROC$ graficamente: scegliamo quindi quella che ci garantisce stabilità, ovvero quella che comprende il cerchio di raggio unitario
![[Pasted image 20220520170203.png|300]]

- osserviamo la $ROC$: è una *regione anulare*
	- Quindi la sua risposta impulsiva $h[n]$ dovrà essere una sequenza **bilatera**

- Antitrasformiamo $H(Z)$, osservando che:
	- Il primo polo è $\frac{1}{2}$, quindi dobbiamo prendere l'esterno del cerchio di tale raggio che produce una sequenza *monolatera destra*
	- Il secondo polo è $2$, quindi dobbiamo prendere l'interno del cerchio di tale raggio che produce una sequenza *monolatera sinistra*
$$
h[n] = \underbrace{\left(-\frac{1}{2}\right)^{n} \ u[n]} - \underbrace{(-2)^{n} \ u[-n-1]}
$$
- Osserviamo gli addendi di $h[n]$:
	- Il primo rappresenta la parte *causale* della risposta impulsiva
	- Il secondo rappresenta la parte *anti-causale* della risposta impulsiva


#### 2) Equazione alle differenze
Dato che la scomposizione in fratti semplici produce una scomposizione in parallelo dell'intero sistema, per trovare l'equazione alle differenze *non è necessario eseguire tale scomposizione in fratti semplici*
- Si può infatti implementare il sistema anche con una rappresentazione **in serie** (cascata)

> [!info] Primo modo: in parallelo (perché in questo caso ho già calcolato i fratti semplici)
>Anche in questo caso si implementa il sistema in modo stabile con più equazioni, cioè metodo di ricorsione (2), perché i poli di $H_{1}$ e $H_{2}$ sono uno interno e uno esterno al cerchio unitario:
>![[Pasted image 20220520171633.png]]

> [!tip] Secondo modo: in cascata
> Fattorizzando il denominatore (così posso scrivere $H(Z)$ come due fattori):
> ![[Pasted image 20220520171819.png|500]]
--> Dove il $H_2(Z)$ non si chiama $H_4(Z)$ perché l'avevo già trovato uguale prima
--> Il numeratore ($\neq 1$) è stato assegnato in maniera arbitraria ad $H_3(Z)$ 
> ![[Pasted image 20220520172103.png|400]]
Sviluppiamo $H_3(Z)$, osservando che il polo è **interno al cerchio unitario**, quindi devo procedere con la ricorsione in avanti (per avere stabilità):
![[Pasted image 20220520172408.png]] Isolando ora $y_1[n]$ si ottiene la ricorsione definitiva: ![[Pasted image 20220520172603.png]] Procediamo ora con $H_2(Z)$, osservando che l'avevamo già analizzato nel precedente esercizio, ma adesso abbiamo un *ingresso diverso* che è proprio $y_1[n]$ (osservando che dovremo effettuare una operazione di ricorsione all'indietro, è conveniente riscrivere $H_2(Z)$ in funzione di $z$ e non di $z^{-1}$): ![[Pasted image 20220520173117.png]]

### ESERCIZIO CON ESPONENZIALE COMPLESSO
Sia:
$$
x[n] = e^{j2\pi F_{0}n} 
$$
Quanto vale l'uscita $y[n]$?
- Non conviene passare dalla funzione di trasferimento perché non è facile fare la trasformata Z di un esponenziale complesso
- Si applica quindi il *teorema della convoluzione* (si calcola l'uscita come convoluzione dell'ingresso (che appunto è un esponenziale complesso) con la risposta impulsiva $h[n]$)

Quindi, partendo dalla relazione fondamentale dei sistemi LTI:
$$
y[n] = x[n] * h[n]
$$
Si procede:
$$
y[n] = x[n] * h[n] = \sum_{k=-\infty}^{\infty} h[k] \ x[n-k] = \sum_{k=-\infty}^{\infty} h[k] \ e^{j2\pi F_{0}(n-k)} = \sum_{k=-\infty}^{\infty} h[k] \ \underbrace{ e^{j2\pi F_{0}n}}_{\text{porto fuori}} \cdot e^{-j2\pi F_{0}k} 
$$
Da cui:
$$
y[n] = \dots = \underbrace{e^{j2\pi F_0n}}_{\large \stackrel{\text{esponenziale}}{\text{in ingresso}}} \underbrace{\sum_{k=-\infty}^{\infty} h[k] e^{-j2\pi F_0k}}_{\left.H(F)\right|_{F=F_{0}}}
$$
Dove $H(F) = \mathscr{F}\{h[n]\}$, ovvero la *risposta in frequenza*

> [!tldr] Dato di fatto
Analogamente ai sistemi tempo continuo quindi: *dato un sistema con una certa risposta impulsiva, quando l'ingresso è un segnale esponenziale complesso (tono?) a una certa frequenza $F_0$, l'uscita è data dallo stesso esponenziale complesso moltiplicato per un numero che è la trasformata di Fourier della risposta impulsiva calcolata alla stessa frequenza dell'esponenziale complesso $F = F_{0}$ *

> [!todo] Risposta in frequenza
> La risposta in frequenza stabilisce proprio come il sistema altera in ampiezza e in fase un esponenziale complesso in ingresso. In modulo e fase dato che: $$ H(F) = |H(F_0)| \ e^{j\angle H(F_0)}$$ E infatti abbiamo nel caso descritto precedentemente: $$y[n] = e^{j2\pi F_{0}n} \ |H(F_0)| \ e^{j\angle H(F_0)} $$ La risposta in frequenza in un sistema LTI è utile anche per capire quali frequenze "passano" e quali vengono filtrate e quindi non passano in uscita. 
> Ad esempio, un filtro passa basso si descrive bene proprio analizzando la risposta in frequenza $H(F)$ (supponendo in ingresso il segnale esponenziale che è rappresentabile come una delta di Dirac): 
> ![[Pasted image 20220520180602.png]]
> In questo caso l'esponenziale complesso "passa" se ha una frequenza compresa tra $-f_t$ e $f_t$ (frequenze di taglio), altrimenti se la frequenza sta al di fuori, il filtro dà un guadagno $0$ e quindi viene esclusa (filtrata) in uscita.
> **Un altro esempio** è il seguente (di come agisce il filtro):
> Per il principio di sovrapposizione degli effetti, il seguente segnale che passa su un filtro passa basso:
> ![[Pasted image 20220520180724.png|400]]
> In uscita avremo il seguente:
> ![[Pasted image 20220520180745.png]]


### ESERCIZIO CON SEGNALE COSENO
Come abbiamo visto anche nel mondo tempo continuo, consideriamo un segnale del tipo:
$$
x[n] = \cos 2\pi f_{0}n
$$
- ovvero un coseno di durata infinita (non c'è il gradino $u[n]$ a moltiplicare)
- ci chiediamo quale sia l'uscita

Possiamo applicare i risultati precedenti relativi alla *risposta in frequenza*, infatti per le formule di Eulero si può riscrivere:
$$
x[n] = \frac{1}{2} e^{j2\pi F_{0}n} + \frac{1}{2} e^{-j2\pi F_{0}n} 
$$
- ovvero abbiamo due *esponenziali complessi* di frequenza rispettivamente $F_{0}$ e $-F_{0}$
	- Ci siamo così ricondotti al caso precedente: sfruttando il principio di sovrapposizione degli effetti nei sistemi LTI, possiamo riscrivere: $$ y[n] = H(F_{0}) \ \frac{1}{2} e^{j2\pi F_{0}n} + H(-F_{0}) \ \frac{1}{2}e^{-j2\pi F_0n} $$

Supponendo $h[n]$ reale (filtro reale)
- Implica che $H(F)$ abbia *simmetria hermitiana*, ovvero: $$ \begin{align*} |H(F)|=|H(-F)|\\ \angle H(F) = - \angle H(-F)  \end{align*} $$
Riscriviamo quindi in forma modulo e fase:
$$
y[n] = |H(F_{0})| e^{j \angle H(F_{0})} \ \frac{1}{2} e^{j2\pi F_{0}n}+|H(-F_{0})| + e^{j \angle H(-F_{0})} \ \frac{1}{2} e^{-j2\pi F_{0}n}
$$
Applicando la parità del modulo e la disparità della fase si ottiene:
$$
|H(F_{0})| e^{j \angle H(F_{0})} \ \frac{1}{2}e^{j2\pi F_{0}n} + |H(F_{0})| \ e^{-j\angle H(F_{0})} \ \frac{1}{2}e^{-j2\pi F_{0}n}
$$
Raccogliendo $|H(F_{0})|$ e applicando nuovamente le formule di Eulero:
$$
y[n] = |H(F_{0})| \ \cos (2\pi F_{0}n+\angle H(F_{0}))
$$
Che è un risultato analogo al caso tempo continuo, in dettaglio:
	- il modulo della risposta in frequenza descrive di quanto viene alterato in ampiezza il coseno di durata infinita
	- la fase della risposta in frequenza descrive di quanto viene alterata la fase del coseno di durata infinita
Controlla i conti qui:
![[Pasted image 20220521150446.png|300]]

